/**
 * @author qiao / https://github.com/qiao
 * @author mrdoob / http://mrdoob.com
 * @author alteredq / http://alteredqualia.com/
 * @author WestLangley / http://github.com/WestLangley
 * @author erich666 / http://erichaines.com
 */// This set of controls performs orbiting, dollying (zooming), and panning.
// Unlike TrackballControls, it maintains the "up" direction object.up (+Y by default).
//
//    Orbit - left mouse / touch: one finger move
//    Zoom - middle mouse, or mousewheel / touch: two finger spread or squish
//    Pan - right mouse, or arrow keys / touch: three finter swipe
THREE.OrbitControls=function(e,t){function x(){return 2*Math.PI/60/60*n.autoRotateSpeed}function T(){return Math.pow(.95,n.zoomSpeed)}function N(e){l.theta-=e}function C(e){l.phi-=e}function O(e){n.object instanceof THREE.PerspectiveCamera?c/=e:n.object instanceof THREE.OrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function M(e){n.object instanceof THREE.PerspectiveCamera?c*=e:n.object instanceof THREE.OrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function _(e){d.set(e.clientX,e.clientY)}function D(e){w.set(e.clientX,e.clientY)}function P(e){g.set(e.clientX,e.clientY)}function H(e){v.set(e.clientX,e.clientY),m.subVectors(v,d);var t=n.domElement===document?n.domElement.body:n.domElement;N(2*Math.PI*m.x/t.clientWidth*n.rotateSpeed),C(2*Math.PI*m.y/t.clientHeight*n.rotateSpeed),d.copy(v),n.update()}function B(e){E.set(e.clientX,e.clientY),S.subVectors(E,w),S.y>0?O(T()):S.y<0&&M(T()),w.copy(E),n.update()}function j(e){y.set(e.clientX,e.clientY),b.subVectors(y,g),A(b.x,b.y),g.copy(y),n.update()}function F(e){}function I(e){var t=0;e.wheelDelta!==undefined?t=e.wheelDelta:e.detail!==undefined&&(t=-e.detail),t>0?M(T()):t<0&&O(T()),n.update()}function q(e){switch(e.keyCode){case n.keys.UP:A(0,n.keyPanSpeed),n.update();break;case n.keys.BOTTOM:A(0,-n.keyPanSpeed),n.update();break;case n.keys.LEFT:A(n.keyPanSpeed,0),n.update();break;case n.keys.RIGHT:A(-n.keyPanSpeed,0),n.update()}}function R(e){d.set(e.touches[0].pageX,e.touches[0].pageY)}function U(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);w.set(0,r)}function z(e){g.set(e.touches[0].pageX,e.touches[0].pageY)}function W(e){v.set(e.touches[0].pageX,e.touches[0].pageY),m.subVectors(v,d);var t=n.domElement===document?n.domElement.body:n.domElement;N(2*Math.PI*m.x/t.clientWidth*n.rotateSpeed),C(2*Math.PI*m.y/t.clientHeight*n.rotateSpeed),d.copy(v),n.update()}function X(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+r*r);E.set(0,i),S.subVectors(E,w),S.y>0?M(T()):S.y<0&&O(T()),w.copy(E),n.update()}function V(e){y.set(e.touches[0].pageX,e.touches[0].pageY),b.subVectors(y,g),A(b.x,b.y),g.copy(y),n.update()}function $(e){}function J(e){if(n.enabled===!1)return;e.preventDefault();if(e.button===n.mouseButtons.ORBIT){if(n.enableRotate===!1)return;_(e),u=o.ROTATE}else if(e.button===n.mouseButtons.ZOOM){if(n.enableZoom===!1)return;D(e),u=o.DOLLY}else if(e.button===n.mouseButtons.PAN){if(n.enablePan===!1)return;P(e),u=o.PAN}u!==o.NONE&&(document.addEventListener("mousemove",K,!1),document.addEventListener("mouseup",Q,!1),n.dispatchEvent(i))}function K(e){if(n.enabled===!1)return;e.preventDefault();if(u===o.ROTATE){if(n.enableRotate===!1)return;H(e)}else if(u===o.DOLLY){if(n.enableZoom===!1)return;B(e)}else if(u===o.PAN){if(n.enablePan===!1)return;j(e)}}function Q(e){if(n.enabled===!1)return;F(e),document.removeEventListener("mousemove",K,!1),document.removeEventListener("mouseup",Q,!1),n.dispatchEvent(s),u=o.NONE}function G(e){if(n.enabled===!1||n.enableZoom===!1||u!==o.NONE&&u!==o.ROTATE)return;e.preventDefault(),e.stopPropagation(),I(e),n.dispatchEvent(i),n.dispatchEvent(s)}function Y(e){if(n.enabled===!1||n.enableKeys===!1||n.enablePan===!1)return;q(e)}function Z(e){if(n.enabled===!1)return;switch(e.touches.length){case 1:if(n.enableRotate===!1)return;R(e),u=o.TOUCH_ROTATE;break;case 2:if(n.enableZoom===!1)return;U(e),u=o.TOUCH_DOLLY;break;case 3:if(n.enablePan===!1)return;z(e),u=o.TOUCH_PAN;break;default:u=o.NONE}u!==o.NONE&&n.dispatchEvent(i)}function et(e){if(n.enabled===!1)return;e.preventDefault(),e.stopPropagation();switch(e.touches.length){case 1:if(n.enableRotate===!1)return;if(u!==o.TOUCH_ROTATE)return;W(e);break;case 2:if(n.enableZoom===!1)return;if(u!==o.TOUCH_DOLLY)return;X(e);break;case 3:if(n.enablePan===!1)return;if(u!==o.TOUCH_PAN)return;V(e);break;default:u=o.NONE}}function tt(e){if(n.enabled===!1)return;$(e),n.dispatchEvent(s),u=o.NONE}function nt(e){e.preventDefault()}this.object=e,this.domElement=t!==undefined?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=Infinity,this.minZoom=0,this.maxZoom=Infinity,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-Infinity,this.maxAzimuthAngle=Infinity,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return f.phi},this.getAzimuthalAngle=function(){return f.theta},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),u=o.NONE},this.update=function(){var t=new THREE.Vector3,i=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),s=i.clone().inverse(),d=new THREE.Vector3,v=new THREE.Quaternion;return function(){var m=n.object.position;return t.copy(m).sub(n.target),t.applyQuaternion(i),f.setFromVector3(t),n.autoRotate&&u===o.NONE&&N(x()),f.theta+=l.theta,f.phi+=l.phi,f.theta=Math.max(n.minAzimuthAngle,Math.min(n.maxAzimuthAngle,f.theta)),f.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=c,f.radius=Math.max(n.minDistance,Math.min(n.maxDistance,f.radius)),n.target.add(h),t.setFromSpherical(f),t.applyQuaternion(s),m.copy(n.target).add(t),n.object.lookAt(n.target),n.enableDamping===!0?(l.theta*=1-n.dampingFactor,l.phi*=1-n.dampingFactor):l.set(0,0,0),c=1,h.set(0,0,0),p||d.distanceToSquared(n.object.position)>a||8*(1-v.dot(n.object.quaternion))>a?(n.dispatchEvent(r),d.copy(n.object.position),v.copy(n.object.quaternion),p=!1,!0):!1}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",nt,!1),n.domElement.removeEventListener("mousedown",J,!1),n.domElement.removeEventListener("mousewheel",G,!1),n.domElement.removeEventListener("MozMousePixelScroll",G,!1),n.domElement.removeEventListener("touchstart",Z,!1),n.domElement.removeEventListener("touchend",tt,!1),n.domElement.removeEventListener("touchmove",et,!1),document.removeEventListener("mousemove",K,!1),document.removeEventListener("mouseup",Q,!1),window.removeEventListener("keydown",Y,!1)};var n=this,r={type:"change"},i={type:"start"},s={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},u=o.NONE,a=1e-6,f=new THREE.Spherical,l=new THREE.Spherical,c=1,h=new THREE.Vector3,p=!1,d=new THREE.Vector2,v=new THREE.Vector2,m=new THREE.Vector2,g=new THREE.Vector2,y=new THREE.Vector2,b=new THREE.Vector2,w=new THREE.Vector2,E=new THREE.Vector2,S=new THREE.Vector2,k=function(){var e=new THREE.Vector3;return function(n,r){e.setFromMatrixColumn(r,0),e.multiplyScalar(-n),h.add(e)}}(),L=function(){var e=new THREE.Vector3;return function(n,r){e.setFromMatrixColumn(r,1),e.multiplyScalar(n),h.add(e)}}(),A=function(){var e=new THREE.Vector3;return function(r,i){var s=n.domElement===document?n.domElement.body:n.domElement;if(n.object instanceof THREE.PerspectiveCamera){var o=n.object.position;e.copy(o).sub(n.target);var u=e.length();u*=Math.tan(n.object.fov/2*Math.PI/180),k(2*r*u/s.clientHeight,n.object.matrix),L(2*i*u/s.clientHeight,n.object.matrix)}else n.object instanceof THREE.OrthographicCamera?(k(r*(n.object.right-n.object.left)/n.object.zoom/s.clientWidth,n.object.matrix),L(i*(n.object.top-n.object.bottom)/n.object.zoom/s.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();n.domElement.addEventListener("contextmenu",nt,!1),n.domElement.addEventListener("mousedown",J,!1),n.domElement.addEventListener("mousewheel",G,!1),n.domElement.addEventListener("MozMousePixelScroll",G,!1),n.domElement.addEventListener("touchstart",Z,!1),n.domElement.addEventListener("touchend",tt,!1),n.domElement.addEventListener("touchmove",et,!1),window.addEventListener("keydown",Y,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});